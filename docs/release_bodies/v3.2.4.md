# whois v3.2.4

中文摘要 / Chinese summary
- 稳定里程碑：在继续拆分（opts/net/cache）前冻结正确性与诊断，给下游一个安全基线。
- 模块化第一步：将条件输出拆分为 `wc_title`、`wc_grep`、`wc_fold`、`wc_output`、`wc_seclog`，并新增 `src/core/pipeline.c` 以便后续编排，行为保持不变。
- GREP 自测钩子：编译开启 `-DWHOIS_GREP_TEST`，运行时设置 `WHOIS_GREP_TEST=1`，自动校验 block/line/line+cont 三种模式，失败时打印诊断，成功输出 `[GREPTEST] ... PASS`。
- 块模式续行启发式改进：仅全局保留第一个“类似标题的缩进行”（如地址），后续同类缩进行若未匹配正则将被过滤，避免带入无关字段。
- 远程构建日志增强：打印 LDFLAGS/LDFLAGS_EXTRA、UPX 可用性与压缩信息、QEMU 或原生冒烟运行器。
- 文档更新（中/英）：补充 grep 自测章节；解释 `wc` 前缀（whois client modules）；清理非英文残留注释。

English summary
- Stability milestone: freeze correctness and diagnostics before further modular splits (opts/net/cache), serving as a safe baseline.
- Modularization step 1: extract conditional output into `wc_title`, `wc_grep`, `wc_fold`, `wc_output`, `wc_seclog`; add `src/core/pipeline.c` for future orchestration while preserving behavior.
- GREP self-test hook: build with `-DWHOIS_GREP_TEST` and run with `WHOIS_GREP_TEST=1` to validate block/line/line+cont; emits `[GREPTEST] ... PASS` on success with diagnostics on failure.
- Block-mode continuation heuristic: keep only the first header-like indented line globally; subsequent header-like indented lines must match the regex, preventing unrelated fields from leaking in.
- Remote build diagnostics: print LDFLAGS/LDFLAGS_EXTRA, UPX availability & compression results, and the QEMU vs native smoke runner.
- Docs updated (CN/EN): add grep self-test section; clarify the `wc` prefix; remove leftover non-English comments.

Highlights / 亮点
- Stability milestone; modularization step 1; grep self-test; smarter continuation handling; enhanced diagnostics; docs updated.

Artifacts / 产物
- whois-x86_64-gnu（CI 动态编译）
- SHA256SUMS.txt（针对 whois-x86_64-gnu 或静态集）
- 七个全静态多架构二进制（musl/loongarch64 见注）：x86_64, x86, aarch64, armv7, mipsel, mips64el, loongarch64

下载 / Downloads

- GitHub Release page / 页面：
	- https://github.com/larsonzh/whois/releases/tag/v3.2.4
- Gitee Release page / 页面：
	- https://gitee.com/larsonzh/whois/releases/tag/v3.2.4

- Direct binaries / 直接下载：
	- x86_64 (CI, glibc): https://github.com/larsonzh/whois/releases/download/v3.2.4/whois-x86_64-gnu
	- x86_64 (static): https://github.com/larsonzh/whois/releases/download/v3.2.4/whois-x86_64
	- x86 (static): https://github.com/larsonzh/whois/releases/download/v3.2.4/whois-x86
	- aarch64 (static): https://github.com/larsonzh/whois/releases/download/v3.2.4/whois-aarch64
	- armv7 (static): https://github.com/larsonzh/whois/releases/download/v3.2.4/whois-armv7
	- loongarch64 (static): https://github.com/larsonzh/whois/releases/download/v3.2.4/whois-loongarch64
	- mips64el (static): https://github.com/larsonzh/whois/releases/download/v3.2.4/whois-mips64el
	- mipsel (static): https://github.com/larsonzh/whois/releases/download/v3.2.4/whois-mipsel

- Checksums / 校验文件：
	- https://github.com/larsonzh/whois/releases/download/v3.2.4/SHA256SUMS.txt

Contracts unchanged / 对外契约不变
- 产物命名（`whois-*`）、命令行参数、输出头/尾契约与折叠单行格式均保持不变。

Verification / 验证
- 远程多架构静态构建通过；GREPTEST：block / line / line+cont 全部 PASS。

Links
- Release notes / 发布说明: `RELEASE_NOTES.md#324`
- Usage docs: CN `docs/USAGE_CN.md` | EN `docs/USAGE_EN.md`
- GitHub Release（发布将创建对应 tag）：https://github.com/larsonzh/whois/releases/tag/v3.2.4
- Gitee Releases（发布后镜像）：https://gitee.com/larsonzh/whois/releases/tag/v3.2.4
