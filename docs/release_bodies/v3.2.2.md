# whois v3.2.2

A tiny, portable whois client purpose-built for BusyBox pipelines.

本版本聚焦“安全加固 + 可观测性”，同时保持经典 WHOIS 纯文本工作流。

---

## Highlights (EN)

- Add optional security diagnostics: `--security-log` (stderr, off by default), with built-in rate limiting (~20 events/sec) and suppression summaries.
- Security hardening across nine areas:
  1) Memory safety helpers (safe malloc/realloc/strdup)
  2) Signal handling & cleanup (SIGINT/TERM/HUP/PIPE)
  3) Input/query validation (length/charset/suspicious payloads)
  4) Redirect/network security (target validation, loop guards, injection/anomaly detection)
  5) Response sanitization/validation (strip control/ANSI sequences; structural checks)
  6) Config validation (illegal/out-of-range detection)
  7) Thread safety & cache integrity (locks/invalidation)
  8) Connection flood/rate monitoring
  9) Protocol-level anomaly detection & logging

## 亮点（CN）

- 新增可选安全日志：`--security-log`（默认关闭，输出到 stderr），内置限频（约 20 条/秒）与抑制汇总，避免异常场景刷屏；不改变 stdout 的“标题/尾行”契约。
- 九大安全方向：
  1) 内存安全辅助（safe malloc/realloc/strdup 封装）
  2) 信号处理与清理（SIGINT/TERM/HUP/PIPE）
  3) 输入/查询校验（长度/字符集/可疑负载）
  4) 重定向/网络安全（目标校验、环路防护、注入/异常识别）
  5) 响应净化与校验（移除控制/ANSI 序列、结构一致性检查）
  6) 配置校验（非法/越界检测）
  7) 线程安全与缓存一致性（加锁与失效策略）
  8) 连接洪泛/速率监测
  9) 协议级异常检测与日志

## Compatibility (EN)

- Remove all experimental RDAP features/switches. Keep classic WHOIS-only behavior to avoid semantic drift and maintenance overhead.

## 兼容性（CN）

- 移除所有 RDAP 实验功能与开关，保持经典 WHOIS 纯文本语义与工作流，避免语义分叉与维护成本。

## Other changes (EN) / 其他改进（CN）

- EN: Fix/clean compile warnings (e.g., -Wsign-compare); convert some counters to `size_t`; support `CFLAGS_EXTRA` for custom builds. Docs updated with security-log usage and troubleshooting (ARIN:43 connectivity).
- CN: 修复/清理编译警告（如 -Wsign-compare），部分计数改为 `size_t`，支持 `CFLAGS_EXTRA`；文档补充安全日志使用与故障排查（含 ARIN:43 连通性提示）。

## Quickstart (EN)

```bash
# Linux / Git Bash
whois-x86_64 8.8.8.8
whois-x86_64 --host apnic -Q 103.89.208.0
printf "8.8.8.8\n1.1.1.1\n" | whois-x86_64 -B -g 'netname|e-mail' --grep 'GOOGLE|CLOUDFLARE' --grep-line --fold
```

```powershell
# Windows PowerShell
whois-x86_64.exe 8.8.8.8
whois-x86_64.exe --host apnic -Q 103.89.208.0
"8.8.8.8`n1.1.1.1" | .\whois-x86_64.exe -B -g 'netname|e-mail' --grep 'GOOGLE|CLOUDFLARE' --grep-line --fold
```

## 快速上手（CN）

```bash
whois-x86_64 8.8.8.8
whois-x86_64 --host apnic -Q 103.89.208.0
printf "8.8.8.8\n1.1.1.1\n" | whois-x86_64 -B -g 'netname|e-mail' --grep 'GOOGLE|CLOUDFLARE' --grep-line --fold
```

## Docs & Links

- Usage (CN): docs/USAGE_CN.md
- Usage (EN): docs/USAGE_EN.md
- Fold before/after: `docs/images/fold-before-after.svg`
- Pipeline diagram: `docs/images/pipeline.svg`

## Artifacts

- GitHub Release attaches: `whois-x86_64-gnu` (CI build), checksum, and seven fully static multi-arch binaries via remote toolchains (aarch64/armv7/x86_64/x86/mipsel/mips64el/loongarch64).
